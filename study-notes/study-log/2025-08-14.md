# 2025-08-14 — LogoutController 주소 문제 해결 기록

---

## 📝 문제 상황  
- `LogoutController`를 만들었는데 로그아웃 URL로 이동이 안 됨.  
- 클릭 시 **404 에러** 발생 → 서버가 `/logout.do` 요청을 못 받음.  

---

## 🔍 원인 분석  
1. **URL 경로 문제**
   - JSP에서 `href="logout.do"` 또는 `href="/logout.do"`를 사용 →  
     컨텍스트 경로(`/프로젝트명`)가 누락되거나 상대경로로 잘못 요청됨.
2. **bean.properties 매핑 문제**
   - `/logout.do` 키가 없거나, 패키지·클래스명이 불일치.
3. **Front Controller URL 패턴 문제**
   - `web.xml`에서 `*.do`로 매핑되지 않음.
4. **리다이렉트 경로 누락**
   - Controller에서 `index.do`로 바로 리다이렉트 → 컨텍스트 경로 빠짐.

---

## 🛠 해결 방법  

### 1) JSP 링크 절대경로로 수정  
```jsp
<a href="${pageContext.request.contextPath}/logout.do">로그아웃</a>
```
또는 버튼 방식:
```jsp
<button id="logoutBtn" data-ctx="${pageContext.request.contextPath}">로그아웃</button>
<script>
  document.getElementById('logoutBtn').onclick = (e) => {
    const ctx = e.currentTarget.getAttribute('data-ctx') || '';
    location.href = ctx + '/logout.do'; // 절대경로 이동
  };
</script>
```

---

### 2) bean.properties 매핑 확인  
```properties
/logout.do=kr.ac.kopo.controller.LogoutController
```
- **슬래시 포함 필수** (`/logout.do`)  
- 클래스 경로/패키지 정확히 맞추기  

---

### 3) web.xml URL 패턴 확인  
```xml
<servlet-mapping>
    <servlet-name>DispatcherServlet</servlet-name>
    <url-pattern>*.do</url-pattern>
</servlet-mapping>
```
- `*.do`로 설정해야 `/logout.do` 요청을 Front Controller가 받음.

---

### 4) LogoutController 리다이렉트 경로 수정  
```java
public class LogoutController implements Controller {
    @Override
    public String handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception {
        HttpSession session = request.getSession(false);
        if (session != null) session.invalidate();

        // 방법 1: 프레임워크에서 redirect: 지원 시
        return "redirect:/index.do";

        // 방법 2: 직접 리다이렉트
        // response.sendRedirect(request.getContextPath() + "/index.do");
        // return null;
    }
}
```

---

## 📌 배운 점  
- JSP에서 URL은 **항상 컨텍스트 경로 포함 절대경로**로 작성해야 안전하다.  
- bean.properties와 web.xml의 URL 매핑이 정확하지 않으면 404가 난다.  
- Controller에서 리다이렉트 시 **컨텍스트 경로**를 반드시 붙여야 한다.  
- 로그 출력으로 `request.getRequestURL()` / `request.getContextPath()`를 확인하면 원인 파악이 빨라진다.  

---

## ✅ 최종 체크리스트  
- [x] 메뉴/버튼 링크 → `${pageContext.request.contextPath}` 포함  
- [x] bean.properties에 `/logout.do` 매핑  
- [x] web.xml `*.do` 매핑  
- [x] Controller 리다이렉트 시 컨텍스트 경로 포함  
- [x] 로그로 경로 확인  
