# 2025-08-07 회고

## 오늘 한 일

# 📄 실시간 아이디 중복 확인 흐름 설명서

### 📅 날짜: 2025-08-06
### 🧑‍💻 목적: 회원가입 시 사용자가 입력한 아이디가 이미 존재하는지 실시간으로 확인하는 기능 구현

---

## 1. 기능 개요

사용자가 아이디를 입력한 후, 입력창을 벗어나면 자동으로 서버에 아이디 중복 여부를 물어보고,  
결과를 즉시 화면에 표시해주는 실시간 아이디 중복 확인 기능입니다.

---

## 2. 전체 흐름 요약

### 🧭 개념 흐름

1. **사용자 입력 (프론트)**
   - 사용자가 아이디 입력창에 아이디를 입력합니다.
   - onblur 이벤트(입력창을 벗어날 때)가 발생합니다.
   - JavaScript에서 서버로 AJAX 요청을 보냅니다.
     
fetch("/checkId.do?id=hello123")


2. **백엔드 처리**
   - /checkId.do 요청을 CheckIdController가 받습니다.
   - MemberService.isExistId("아이디 값 ") 호출
   - MemberDAOImpl에서 DB에 쿼리 실행:
     
sql
     SELECT COUNT(*) FROM tbl_member WHERE id = 'hello123'

   - 결과를 바탕으로 텍스트 응답을 보냅니다: "exist" 또는 "available"
     - 서버가 자바스크립트에게 아래와 같은 결과 값을 보낸다 
     - response.getWriter().write("exist");      // 이미 있음
     - response.getWriter().write("available");  // 사용 가능

3. **응답 결과 표시**
   - JS가 응답을 받습니다.
   - <span id="idCheckResult">에 결과 메시지를 출력합니다.
     - 이미 존재할 경우: 빨간색 메시지 "이미 사용 중인 아이디입니다."
     - 사용 가능할 경우: 초록색 메시지 "사용 가능한 아이디입니다."

---

## 3. 주요 코드 요약

### ✅ signUp.jsp

jsp
<input type="text" id="id" name="id" onblur="checkId()">
<span id="idCheckResult"></span>

<script>
  function checkId() {
    const id = document.getElementById("id").value;
    const result = document.getElementById("idCheckResult");

    if (id === "") {
      result.innerText = "아이디를 입력해주세요.";
      result.style.color = "red";
      return;
    }

    fetch("/checkId.do?id=" + encodeURIComponent(id))
      .then(res => res.text())
      .then(data => {
        if (data === "exist") {
          result.innerText = "이미 사용 중인 아이디입니다.";
          result.style.color = "red";
        } else if (data === "available") {
          result.innerText = "사용 가능한 아이디입니다.";
          result.style.color = "green";
        }
      });
  }
</script>


### ✅ CheckIdController.java

java
public class CheckIdController implements Controller {
    private MemberService memberService = new MemberService();

    @Override
    public String handleRequest(HttpServletRequest request, HttpServletResponse response) {
        try {
            String id = request.getParameter("id");
            boolean exists = memberService.isExistId(id);
            response.setContentType("text/plain; charset=UTF-8");
            response.getWriter().write(exists ? "exist" : "available");
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null;
    }
}


### ✅ MemberService.java

java
public boolean isExistId(String id) {
    return memberDao.isExistId(id);
}


### ✅ MemberDAOImpl.java

java
@Override
public boolean isExistId(String id) {
    String sql = "SELECT COUNT(*) FROM tbl_member WHERE id = ?";
    try (Connection conn = new ConnectionFactory().getConnection();
         PreparedStatement pstmt = conn.prepareStatement(sql)) {
        pstmt.setString(1, id);
        ResultSet rs = pstmt.executeQuery();
        return rs.next() && rs.getInt(1) > 0;
    } catch (Exception e) {
        throw new RuntimeException("아이디 중복 확인 중 오류 발생", e);
    }
}


---

## 4. 예외 처리 방식 (A 방식)

- DAO에서 발생하는 예외를 RuntimeException으로 감싸서 던집니다.
- 상위 Service와 Controller에서는 throws Exception 없이 처리 가능합니다.

---

## 5. 사용자 시나리오 예시

- 사용자가 user을 입력하고 포커스를 벗어남
- 서버에 AJAX 요청: /checkId.do?id=user
- 서버 응답: "exist" -> 값 보냄
- 화면에 빨간색 메시지: "이미 사용 중인 아이디입니다."

---



[회원가입 Controller]
        ↓
[MemberService.isExistId(id)]
        ↓
[MemberDAOImpl.isExistId(id)]
        ↓
[DB - tbl_member]

✅ 요약: 총 3곳에 걸쳐 구성

파일	할 일
MemberDAO.java	boolean isExistId(String id) 메서드 선언
MemberDAOImpl.java	SELECT COUNT(*) 쿼리로 메서드 구현
MemberService.java	memberDao.isExistId(id) 호출하여 중계

이런식으로 정리 